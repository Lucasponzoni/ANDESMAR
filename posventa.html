<!DOCTYPE html>
<html lang="es">
<head>

    <script>
        const userType = localStorage.getItem('userType');
        if (userType === 'placeit') {
          localStorage.setItem('accessDenied', 'true');
          window.location.replace('MeliArPlaceit.html');
        } else {
          const savedTimestamp = localStorage.getItem('loginTimestamp');
          const isExpired = !savedTimestamp || (Date.now() - savedTimestamp) > 28800000;
          if (isExpired) {
            window.location.replace('logipaq.html');
          }
        }
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envios</title>
    
    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Signika:wght@300..700&family=Titan+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Reddit+Sans+Condensed:wght@200..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Signika+Negative:wght@300..700&display=swap" rel="stylesheet">  
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="shortcut icon" href="./Img/caja.png">
    
    <style>
        /* Reducir el padding en las últimas tres columnas de la tabla específica */
        #data-table th:nth-last-child(-n+3),
        #data-table td:nth-last-child(-n+3) {
            padding: 10px; 
        }
        
        /* Estilo específico para esta página */
        .search-container-top {
            max-width: 85%; /* Aumentar ancho del contenedor de búsqueda */
        }

        #cards-container {
            max-width: 85%; /* Aumentar ancho del contenedor de tarjetas */
        }

        /* Media query para pantallas de 950px o menos */
        @media (max-width: 992px) {
            .search-container-top,
            #cards-container {
                max-width: 100% !important; /* Cambiar a 100% en pantallas pequeñas */
            }
        }
    </style>
</head>

<body class="envios-body">

    <!-- Navegación -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="./Img/Novogar N.png" alt="Logo" class="navbar-logo">
                <span class="navbar-brand-text">L<span class="navbar-brand-text4">gi</span><span class="navbar-brand-text2">Paq</span> <img class="blackCat" src="./Img/Location.gif" alt="LogiPaq" srcset=""> </span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item"><a href="./index.html" class="nav-link">Etiquetado</a></li>
                    <li class="nav-item"><a href="./envios.html" class="nav-link">Envios Andesmar</a></li>
                    <li class="nav-item"><a href="./despachos.html" class="nav-link">Logistica</a></li>
                    <li class="nav-item"><a href="./bna.html" class="nav-link">Tiendas Virtuales</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            MeLi <img id="meli-logo" src="./Img/meli.png">
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="./facturacionMl.html">Facturacion Mercado libre</a>
                            <a class="dropdown-item" href="./meliAr.html">Envios Mercado Libre</a>
                            <a class="dropdown-item" href="./controlMeli.html">Colecta Mercado libre</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Más
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="./tipeoWeb.html">Despacho Logistico</a>
                            <a class="dropdown-item" href="./MeliArPlaceit.html">Mercado Libre PlaceIt</a>
                            <a class="dropdown-item" href="./bnaPlaceIt.html">Tiendas Virtuales PlaceIt</a>
                            <a class="dropdown-item" href="./simbel.html">Venta Web PlaceIt</a>
                            <a class="dropdown-item" href="./panelPlaceIt.html"><i class="bi bi-gear-fill mr-1"></i>Panel PlaceIt</a>
                            <a class="dropdown-item" href="./catalogo.html">Catalogo de Productos</a>
                            <a class="dropdown-item" href="./jsonSimbel.html">Export Json Simbel</a>  
                            <a class="dropdown-item active" href="#">Posventa</a>                    
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenedor principal -->
    <div class="container mt-4 search-container-top">
        <!-- Contenedor de búsqueda y botones -->
        <div class="row justify-content-between align-items-center search-filter-container">
            <div class="col-md-6 mb-3">
                <div class="input-group">
                    <input type="text" class="form-control" id="searchFacturacion" placeholder="Buscar por operacion, cliente, estado...">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button">
                            <i class="fas fa-search" style="font-size: 22px"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-12 mb-3 d-flex justify-content-start ingreso-egreso trio-de-botones" style="overflow-x: auto; white-space: nowrap; padding-top: 20px;">
    
                <!-- Botón dinámico "Ir atrás" -->
                <button id="btnIrAtras" class="btn btn-secondary d-none">
                    <i class="bi bi-arrow-left-circle-fill" style="font-size: 22px;"></i> Ir atrás
                </button>
            
                <!-- Botón para abrir el modal de importación -->
                <button id="btnImportar" class="btn btn-light" data-toggle="modal" data-target="#importModal">
                    <i class="bi bi-file-earmark-plus-fill" style="font-size: 22px; color: #2d853c;"></i> Importar Datos
                </button> 
                
                <button id="btnFiltrar" class="btn btn-light" data-toggle="modal" data-target="#filtrarModal">
                    <i class="bi bi-check2-square" style="font-size: 22px; color: #3d2d85;"></i> Filtrar Estados
                </button>  
            
                <!-- Botón para Skills -->
                <button id="btnSkills" class="btn btn-light" data-toggle="modal" data-target="#skillsModal">
                    <i class="bi bi-bookmarks-fill" style="font-size: 22px; color: #007bff;"></i> Skills
                </button>

                <!-- Botón para Minutas -->
                <button id="btnMinutas" class="btn btn-light" data-toggle="modal" data-target="#minutasModal">
                    <i class="bi bi-receipt" style="font-size: 22px; color: #ff8400;"></i> Control de Minutas
                </button>

                <!-- Botón para Control rápido -->
                <button id="btnMinutas" class="btn btn-light" onclick="ejecutarControlRapido()">
                    <i class="bi bi-exclamation-circle-fill" style="font-size: 22px; color: green;"></i> Control rápido
                </button>
            
                <!-- Botón Pendientes de controlar -->
                <button id="btnPendientesControlar" class="btn btn-light position-relative">
                    <i class="bi bi-eye-slash-fill" style="font-size: 22px; color: #d9534f;"></i> Pendientes de controlar
                    <span id="contadorCards2" class="badge badge-light position-absolute top-0 start-100 translate-middle rounded-pill ios-badge">
                        <i class="fas fa-spinner fa-spin"></i>
                    </span>
                </button>                
            
                <button class="btn btn-light ml-2" id="sinRevisar" title="Promedio Despacho: Xd Yh Zm">
                    <i class="bi bi-calculator"></i> Calculando sin Revisar...
                </button>                
            
                <button class="btn btn-light ml-2" id="promedioBtn" title="Promedio Despacho: Xd Yh Zm">
                    <i class="bi bi-calculator"></i> Contando Filas...
                </button>     
            </div>
                    
        </div>
    </div>
    </head>
    <body>

            <!-- Contenedor de tarjetas -->
    <div class="container mt-5" id="cards-container">                   
        
        <div class="spinner-border spinner-border37892" role="status" id="spinner">
            <img src="./Img/Novogar N.png" alt="Imagen" class="spinner-image">
            <span class="sr-only">Cargando...</span>
        </div>   

        <style>
            .producto-column {
                width: 170px !important;
                word-break: break-word;
            }
        
            .skill-filter-wrapper {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            }
        
            .table th {
                vertical-align: middle;
            }
        </style>
        
        <div class="table-responsive">
            <table id="data-table" class="table table-striped tabla-posventa">
                <thead>
                    <tr>
                        <th><i class="bi bi-calendar-check-fill"></i> Operación</th>
                        <th class="producto-column"><i class="bi bi-cart-check-fill"></i> Compra</th>
                        <th style="font-size: 12px;" class="estado-column"><i class="bi bi-geo-alt-fill"></i> Estado</th>
                        <th style="font-size: 12px;">
                            <div class="skill-filter-wrapper">
                                <i class="bi bi-info-circle-fill me-1"></i> Descripción de estado
                                <div class="dropdown skill-filter-dropdown">
                                    <button id="btn-filtrar-skills" class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                        Filtrar por skill
                                    </button>
                                    <ul id="skills-container" class="dropdown-menu custom-skill-menu mt-1"></ul>
                                </div>
                                <button id="clear-skill-filter" class="btn btn-outline-secondary">Limpiar filtro</button>
                            </div>
                        </th>
                        <th><i class="bi bi-diagram-3-fill"></i> Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Los datos se llenarán aquí dinámicamente -->
                </tbody>
            </table>
        </div>     
        
        <script>
            document.getElementById("btn-filtrar-skills").addEventListener("click", () => {
                const skillSet = new Set();
        
                // Recorremos todos los divs que tengan clase que empiece con "div-skills-"
                document.querySelectorAll('div[class^="div-skills-"]').forEach(div => {
                    div.querySelectorAll("span[data-skill]").forEach(span => {
                        skillSet.add(span.getAttribute("data-skill"));
                    });
                });
        
                // Convertimos el Set a un array y lo ordenamos alfabéticamente
                const sortedSkills = Array.from(skillSet).sort();
        
                // Generar checkboxes en el dropdown
                const container = document.getElementById("skills-container");
                container.innerHTML = ""; // Limpia por si ya había algo
        
                sortedSkills.forEach(skill => {
                    const id = `skill_${skill.replace(/\s+/g, "_")}`;
                    container.innerHTML += `
                        <li>
                            <label class="dropdown-item">
                                <input type="checkbox" value="${skill}" id="${id}" onchange="aplicarFiltroSkills()"> ${skill}
                            </label>
                        </li>
                    `;
                });
            });
        
            function aplicarFiltroSkills() {
                const seleccionados = Array.from(document.querySelectorAll('#skills-container input:checked')).map(cb => cb.value);
        
                // Si no hay selección, mostrar todo
                if (seleccionados.length === 0) {
                    document.querySelectorAll("tr").forEach(row => row.style.display = "");
                    return;
                }
        
                document.querySelectorAll("tr").forEach(row => {
                    const skillDiv = row.querySelector('div[class^="div-skills-"]');
                    if (!skillDiv) return;
        
                    const skillsEnFila = Array.from(skillDiv.querySelectorAll("span[data-skill]")).map(span => span.getAttribute("data-skill"));
                    const coincide = seleccionados.some(skill => skillsEnFila.includes(skill));
                    row.style.display = coincide ? "" : "none";
                });
            }
        
            document.getElementById("clear-skill-filter").addEventListener("click", function() {
                const checkboxes = document.querySelectorAll('#skills-container input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                aplicarFiltroSkills();
            });
            </script> 

            <script>
            // Función para contar filas pendientes
            function contarFilasPendientes() {
                const hoy = new Date();
                const dia = String(hoy.getDate()).padStart(2, '0');
                const mes = String(hoy.getMonth() + 1).padStart(2, '0');
                const anio = hoy.getFullYear();
                const fechaHoy = `${dia}/${mes}/${anio}`;

                const filas = document.querySelectorAll("#data-table tbody tr");
                let contadorPendientes = 0;

                filas.forEach(fila => {
                    const mensaje = fila.querySelector(".mensaje-filaDeDatos");

                    if (!mensaje) {
                        contadorPendientes++;
                    } else {
                        const texto = mensaje.innerText;
                        const match = texto.match(/(\d{2}\/\d{2}\/\d{4})/);

                        if (!match || match[1] !== fechaHoy) {
                            contadorPendientes++;
                        }
                    }
                });

                const badge = document.getElementById("contadorCards2");
                badge.innerHTML = contadorPendientes;

                // Actualizar el botón con el número de filas pendientes
                const boton = document.getElementById("sinRevisar");
                if (contadorPendientes === 0) {
                    boton.title = "Nada por Ahora ☕️";
                    boton.innerHTML = `<i class="fas fa-cog"></i> Nada por Ahora ☕️`;
                } else {
                    boton.title = `Promedio Despacho: ${contadorPendientes} sin Revisar`;
                    boton.innerHTML = `<i class="fas fa-cog fa-spin"></i> Quedan ${contadorPendientes}`;
                }
            }

            // Función para manejar la lógica del botón "btnPendientesControlar"
            function manejarPendientesControlar() {
                const hoy = new Date();
                const dia = String(hoy.getDate()).padStart(2, '0');
                const mes = String(hoy.getMonth() + 1).padStart(2, '0');
                const anio = hoy.getFullYear();
                const fechaHoy = `${dia}/${mes}/${anio}`;

                const filas = document.querySelectorAll("#data-table tbody tr");
                let algunaPendiente = false;

                filas.forEach(fila => {
                    const mensaje = fila.querySelector(".mensaje-filaDeDatos");

                    if (!mensaje) {
                        fila.style.display = "";
                        algunaPendiente = true;
                    } else {
                        const texto = mensaje.innerText;
                        const match = texto.match(/(\d{2}\/\d{2}\/\d{4})/);

                        if (!match || match[1] !== fechaHoy) {
                            fila.style.display = "";
                            algunaPendiente = true;
                        } else {
                            fila.style.display = "none";
                        }
                    }
                });

                if (algunaPendiente) {
                    document.getElementById("btnIrAtras").classList.remove("d-none");
                }
            }

            // Evento para el botón "sinRevisar"
            document.getElementById("sinRevisar").addEventListener("click", function () {
                contarFilasPendientes(); // Llama a la función para contar filas pendientes
                manejarPendientesControlar(); // Llama a la función para manejar los pendientes
            });

            // Evento para el botón "btnPendientesControlar"
            document.getElementById("btnPendientesControlar").addEventListener("click", manejarPendientesControlar);

            // Evento para el botón "btnIrAtras"
            document.getElementById("btnIrAtras").addEventListener("click", function () {
                const filas = document.querySelectorAll("#data-table tbody tr");

                filas.forEach(fila => {
                    fila.style.display = "";
                });

                this.classList.add("d-none");
            });

            // Mostrar spinner al iniciar
            document.getElementById("contadorCards2").innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            </script> 
            
        <!-- Modal de Control de Minutas -->
        <div class="modal fade" id="minutasModal" tabindex="-1" role="dialog" aria-labelledby="minutasModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content" style="border-radius: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen;">
                    <div class="modal-header" style="border-bottom: none;">
                        <h5 class="modal-title" id="minutasModalLabel">📝 Control de Minutas</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="font-size: 2rem;">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body text-center">
                        <div id="spinner4" class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                            <span class="sr-only">Cargando...</span>
                        </div>
                        <div id="tableContainer" style="display:none; max-height: 65vh; overflow-y: auto; padding: 10px;">
                            <!-- Tabla generada dinámicamente -->
                        </div>
                        <div class="modal-footer">
                            <!-- Botón para enviar email -->
                            <button id="enviarEmailBtn" class="btn btn-primary">
                                <i class="bi bi-envelope-fill"></i> Enviar Email de Control
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Fin Modal de Control de Minutas -->
     
        <!-- Modal de Importación -->
        <div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="importModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content" style="border-radius: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;">
                    <div class="modal-header">
                        <h5 class="modal-title" id="importModalLabel">Importar Archivo XLSX</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row justify-content-center">
                            <div class="col-lg-8 col-md-10 col-sm-12">
                                <div class="input-group">
                                    <input type="file" id="fileInput" accept=".xls,.xlsx" class="form-control">
                                    <div class="input-group-append">
                                        <button id="importButton" class="btn btn-primary">
                                            <i class="bi bi-filetype-xls"></i> Importar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Fin Modal de Importación -->

        <!-- Modal de Skills en Filas-->
        <div class="modal fade" id="skillsModalFilas" tabindex="-1" aria-labelledby="skillsModalFilasLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 15px;">
                <div class="modal-header">
                <h5 class="modal-title" id="skillsModalFilasLabel">Seleccionar Skills</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" id="skillsModalFilasBody" style="display: flex; flex-wrap: wrap;"></div>
            </div>
            </div>
        </div>
        <!-- Fin Modal de Skills en Filas -->

        <!-- Modal de Comentarios -->
        <div class="modal fade" id="comentarioModal" tabindex="-1" aria-labelledby="comentarioModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content"> 
                    <div class="modal-header">
                        <h5 class="modal-title" id="comentarioModalLabel">Comentarios de la Venta</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="ventaIdInput" />
                        <div class="mb-3">
                            <label for="comentarioOperacion" class="form-label">Comentario de la Operación</label>
                            <textarea id="comentarioOperacion" class="form-control" style="border-radius: 10px !important; min-height: 200px;"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="numeroCaso" class="form-label">Número de Caso MeLi</label>
                            <input type="text" id="numeroCaso" class="form-control" />
                        </div>
                        <div class="mb-3">
                            <label for="vencimientoDevolucion" class="form-label">Vencimiento de Devolución</label>
                            <input type="date" id="vencimientoDevolucion" class="form-control" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-primary" onclick="guardarComentario()">Guardar Comentario</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Fin Modal de Comentarios -->

        <!-- Modal de Skills -->
        <div class="modal fade" id="skillsModal" tabindex="-1" role="dialog" aria-labelledby="skillsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content" style="border-radius: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;">
                    <div class="modal-header">
                        <h5 class="modal-title" id="skillsModalLabel">Agregar Skills</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="sku-input-group mb-3 d-flex">
                            <input type="text" class="form-control sku-input" id="newSkuInputPlaceIt" placeholder="Ingrese el nombre del skill" aria-label="Nuevo Skill" aria-describedby="addSkuButtonPlaceIt">
                            <button id="addSkuButtonPlaceIt" class="btn btn-primary">Agregar Skill</button>
                        </div>

                        <div class="color-picker-container mb-1">
                            <label class="form-label fw-semibold">🎨 Colores Rápidos:</label>
                            <div class="d-flex flex-wrap gap-2 mb-3">
                                <!-- Paleta pastel extendida -->
                                <button class="color-swatch" style="background-color: #ffd1dc;" data-color="#ffd1dc"></button>
                                <button class="color-swatch" style="background-color: #ff9fbf;" data-color="#ff9fbf"></button>
                                <button class="color-swatch" style="background-color: #ff7f9f;" data-color="#ff7f9f"></button>
                                <button class="color-swatch" style="background-color: #ff4d7f;" data-color="#ff4d7f"></button>
                                <button class="color-swatch" style="background-color: #f6eac2;" data-color="#f6eac2"></button>
                                <button class="color-swatch" style="background-color: #e2c85a;" data-color="#e2c85a"></button>
                                <button class="color-swatch" style="background-color: #d1b24d;" data-color="#d1b24d"></button>
                                <button class="color-swatch" style="background-color: #a78a3c;" data-color="#a78a3c"></button>
                                <button class="color-swatch" style="background-color: #bae1ff;" data-color="#bae1ff"></button>
                                <button class="color-swatch" style="background-color: #8ab8ff;" data-color="#8ab8ff"></button>
                                <button class="color-swatch" style="background-color: #6a9aff;" data-color="#6a9aff"></button>
                                <button class="color-swatch" style="background-color: #3f7cff;" data-color="#3f7cff"></button>
                                <button class="color-swatch" style="background-color: #e0c3fc;" data-color="#e0c3fc"></button>
                                <button class="color-swatch" style="background-color: #b78cfc;" data-color="#b78cfc"></button>
                                <button class="color-swatch" style="background-color: #9b6efc;" data-color="#9b6efc"></button>
                                <button class="color-swatch" style="background-color: #7a5eea;" data-color="#7a5eea"></button>
                                <button class="color-swatch" style="background-color: #ffe3a3;" data-color="#ffe3a3"></button>
                                <button class="color-swatch" style="background-color: #ffcc7a;" data-color="#ffcc7a"></button>
                                <button class="color-swatch" style="background-color: #ffb34d;" data-color="#ffb34d"></button>
                                <button class="color-swatch" style="background-color: #ff9f1a;" data-color="#ff9f1a"></button>
                                <button class="color-swatch" style="background-color: #e2f0cb;" data-color="#e2f0cb"></button>
                                <button class="color-swatch" style="background-color: #b3d68f;" data-color="#b3d68f"></button>
                                <button class="color-swatch" style="background-color: #8bbf5f;" data-color="#8bbf5f"></button>
                                <button class="color-swatch" style="background-color: #6da03a;" data-color="#6da03a"></button>
                                <button class="color-swatch" style="background-color: #fcd5ce;" data-color="#fcd5ce"></button>
                                <button class="color-swatch" style="background-color: #f9a3a3;" data-color="#f9a3a3"></button>
                                <button class="color-swatch" style="background-color: #f97c7c;" data-color="#f97c7c"></button>
                                <button class="color-swatch" style="background-color: #f94c4c;" data-color="#f94c4c"></button>
                                <button class="color-swatch" style="background-color: #cce5ff;" data-color="#cce5ff"></button>
                                <button class="color-swatch" style="background-color: #99c2ff;" data-color="#99c2ff"></button>
                                <button class="color-swatch" style="background-color: #66a3ff;" data-color="#66a3ff"></button>
                                <button class="color-swatch" style="background-color: #2e7eff;" data-color="#2e7eff"></button>
                                <button class="color-swatch" style="background-color: #d5f4e6;" data-color="#d5f4e6"></button>
                                <button class="color-swatch" style="background-color: #aee3d5;" data-color="#aee3d5"></button>
                                <button class="color-swatch" style="background-color: #7bd0c4;" data-color="#7bd0c4"></button>
                                <button class="color-swatch" style="background-color: #4ab8a3;" data-color="#4ab8a3"></button>
                                <button class="color-swatch" style="background-color: #f9f7cf;" data-color="#f9f7cf"></button>
                                <button class="color-swatch" style="background-color: #e4e1a1;" data-color="#e4e1a1"></button>
                                <button class="color-swatch" style="background-color: #d1d08f;" data-color="#d1d08f"></button>
                                <button class="color-swatch" style="background-color: #b0b05f;" data-color="#b0b05f"></button>        
                                <button class="color-swatch" style="background-color: #ffb3e6;" data-color="#ffb3e6"></button>
                                <button class="color-swatch" style="background-color: #ff80e1;" data-color="#ff80e1"></button>
                                <button class="color-swatch" style="background-color: #ff4db3;" data-color="#ff4db3"></button>
                                <button class="color-swatch" style="background-color: #ff1a8a;" data-color="#ff1a8a"></button>
                                <button class="color-swatch" style="background-color: #ffe6b3;" data-color="#ffe6b3"></button>
                                <button class="color-swatch" style="background-color: #ffdb80;" data-color="#ffdb80"></button>
                                <button class="color-swatch" style="background-color: #ffcc33;" data-color="#ffcc33"></button>
                                <button class="color-swatch" style="background-color: #ffb300;" data-color="#ffb300"></button>
                                <button class="color-swatch" style="background-color: #b3ffe0;" data-color="#b3ffe0"></button>
                                <button class="color-swatch" style="background-color: #80ffcc;" data-color="#80ffcc"></button>
                                <button class="color-swatch" style="background-color: #33ff99;" data-color="#33ff99"></button>
                                <button class="color-swatch" style="background-color: #00ff66;" data-color="#00ff66"></button>
                                <button class="color-swatch" style="background-color: #b3e0ff;" data-color="#b3e0ff"></button>
                                <button class="color-swatch" style="background-color: #80c2ff;" data-color="#80c2ff"></button>
                            </div>
                        </div>

                        <label for="colorPicker" class="form-label fw-semibold">🌈 Color Personalizado:</label>
                        <div class="custom-color-wrapper">
                            <div class="custom-color-label">Haz clic para abrir la paleta</div>
                            <input type="color" id="colorPicker" value="#007bff" class="custom-color-input">
                        </div>

                        <label for="skillDescription" class="form-label fw-semibold">📝 Descripción del skill:</label>
                        <textarea id="skillDescription" class="form-control mb-3" rows="3" placeholder="Escribe la descripción del skill aquí... (Esto servirá para el armado del Martillo)" style="border-radius: 10px !important;"></textarea>

                        <div id="spinner" class="text-center" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Cargando...</span>
                            </div>
                        </div>

                        <div id="skillsContainer" class="d-flex flex-wrap"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <style>
            .color-swatch {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: border 0.2s, transform 0.2s;
            }
        
            .color-swatch:hover {
            border: 2px solid #666;
            transform: scale(1.1);
            }
        
            .custom-color-wrapper {
                display: inline-flex;
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
                padding: 12px 16px;
                background: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                border: 1px solid rgba(200, 200, 200, 0.4);
                border-radius: 14px;
                width: fit-content;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.03);
                transition: all 0.25s ease;
                cursor: pointer;
                }

                .custom-color-wrapper:hover {
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08), inset 0 0 0 0.5px rgba(255, 255, 255, 0.5);
                transform: translateY(-2px);
                }
        
            .custom-color-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 6px;
            font-style: italic;
            }
        
            .custom-color-input {
            appearance: none;
            -webkit-appearance: none;
            border: none;
            width: 50px;
            height: 32px;
            border-radius: 8px;
            background-color: transparent;
            cursor: pointer;
            padding: 0;
            }
        
            .custom-color-input::-webkit-color-swatch-wrapper {
            padding: 0;
            }
        
            .custom-color-input::-webkit-color-swatch {
            border: none;
            border-radius: 8px;
            }
        
            input, select, textarea {
            margin-bottom: 0px !important;
        }
        </style>
        
        <script>
            document.querySelectorAll('.color-swatch').forEach(swatch => {
            swatch.addEventListener('click', () => {
                const color = swatch.getAttribute('data-color');
                document.getElementById('colorPicker').value = color;
            });
            });
        </script>  

        <script>
            // Al hacer clic en un swatch, actualiza el input color
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.addEventListener('click', () => {
                    const color = swatch.getAttribute('data-color');
                    document.getElementById('colorPicker').value = color;
                });
            });
        </script>
        <!-- Fin Modal Skills -->

        <!-- Modal Filtrar Estados -->
        <div class="modal fade" id="filtrarModal" tabindex="-1" role="dialog" aria-labelledby="filtrarModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content" style="border-radius: 16px;">
                <div class="modal-header">
                <h5 class="modal-title" id="filtrarModalLabel">📋 Filtrar Estados</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body" id="filtrarEstadosContenido" style="min-height: 200px;">
                <!-- Spinner y checkboxes se cargan por JS -->
                </div>
                <div class="modal-footer">
                <button id="guardarEstadosBtn" class="btn btn-primary swal2-macos-button" style="display: none;">Guardar cambios</button>
                </div>
            </div>
            </div>
        </div>

        <!-- Modal Línea de Tiempo -->
        <div class="modal fade" id="timelineModal" tabindex="-1" aria-labelledby="timelineModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-light text-dark">
                    <div class="modal-header bg-light text-dark">
                        <h5 class="modal-title text-dark" id="timelineModalLabel">Línea de Tiempo Estados</h5>
                    </div>
                    <div class="modal-body">
                        <ul id="timelineContent" class="timeline" style="display: none; list-style: none; padding: 0; margin: 0;">
                            <!-- Los estados se agregarán dinámicamente aquí -->
                        </ul>
                    </div>

                    <div class="modal-footer d-flex justify-content-center">
                        <div class="alert-modal-Pi text-center">
                            <span>Para cerrar haga click fuera de la ventana</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- Fin Modal Línea de Tiempo -->

        <!-- Pagination -->
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center" style="display:none;" id="pagination"></ul>
        </nav>
    </div>

    <!-- Spinner centrado con fondo difuminado -->
    <div id="spinnerOverlay" class="import-spinner-overlay justify-content-center align-items-center" style="display:none;">
        <div class="import-spinner-container">
            <img id="spinnerImage" src="./Img/etiqueta-animada.gif" alt="Cargando...">
            <div id="spinnerProgress" class="import-spinner-progress">0%</div>
        </div>
    </div>

    <!-- Avatars -->  
    <div class="avatar-container">
        <!-- Avatares clickeables -->
        <div class="avatar" onclick="selectAvatar('alexis_guidi.png', 'Alexis Guidi', this)">
            <img src="./Img/alexis_guidi.png" alt="Alexis Guidi">
        </div>
        <div class="avatar" onclick="selectAvatar('elias_pignani.png', 'Elias Pignani', this)">
            <img src="./Img/elias_pignani.png" alt="Elias Pignani">
        </div>
        <div class="avatar" onclick="selectAvatar('georgina_suarez.png', 'Georgina Suarez', this)">
            <img src="./Img/georgina_suarez.png" alt="Georgina Suarez">
        </div>
        <div class="avatar" onclick="selectAvatar('alejo_aviles.png', 'Alejo Aviles', this)">
            <img src="./Img/alejo_aviles.png" alt="Alejo Aviles">
        </div>
        <div class="avatar" onclick="selectAvatar('joel_fernandez.png', 'Joel Fernandez', this)">
            <img src="./Img/joel_fernandez.png" alt="Joel Fernandez">
        </div>
        <div class="avatar" onclick="selectAvatar('esperanza_toffalo.png', 'Esperanza Toffalo', this)">
            <img src="./Img/esperanza_toffalo.png" alt="Esperanza Toffalo">
        </div>
        <div class="avatar" onclick="selectAvatar('lucas_ponzoni.png', 'Lucas Ponzoni', this)">
            <img src="./Img/lucas_ponzoni.png" alt="Lucas Ponzoni">
        </div>
    </div>

    <!-- Avatar Activo Siempre Abajo -->
    <div class="selected-avatar-wrapper">
        <div class="selected-avatar" id="selected-avatar">
            <img id="active-avatar" src="./Img/avatar-black.png" alt="Avatar seleccionado">
        </div>
        <div class="online-indicator"></div>
    </div>
    <!-- Avatars -->  
    
    <!-- Botón de flecha hacia arriba -->
    <a href="#" id="scrollToTop" class="btn btn-warning" style="display: none;">
        <i class="fas fa-arrow-up"></i>
    </a>

    <!-- Botón de flecha hacia Abajo -->
    <a href="#" id="scrollToDown" class="btn btn-warning" style="display: none;">
        <i class="fas fa-arrow-down"></i> <!-- Cambiar a flecha hacia abajo -->
    </a>

    <!-- Info WiFi -->
    <div id="notification-ios-wifi" class="notification-ios-wifi">
        <img src="./Img/wifiLogi.gif" alt="WiFi Icon" class="wifi-icon-ios-wifi">
        <span id="notification-text-ios-wifi"><strong></strong>¡Conexión perdida!</strong><br>No se preocupe, cuando la conexión vuelva, la página se recargará automáticamente.</span>
        <span class="close-btn-ios-wifi" onclick="closeNotification()">✖</span>
        <button id="retry-button-ios-wifi" class="retry-button-ios-wifi" onclick="reloadPage()">Reintentar</button>
    </div>
    
    <script>
        let isOnline = navigator.onLine;

        function showNotification() {
            const notification = document.getElementById('notification-ios-wifi');
            notification.style.display = 'flex';
            notification.classList.add('blink');
            document.getElementById('notification-text-ios-wifi').innerHTML = '<strong class="LogiPaq-wifi">LogiPaq</strong><br><strong>¡Conexión perdida!</strong><br>No se preocupe, cuando la conexión vuelva, la página se recargará automáticamente.';
            document.getElementById('retry-button-ios-wifi').textContent = 'Reintentar';
        }

        function closeNotification() {
            const notification = document.getElementById('notification-ios-wifi');
            notification.style.display = 'none';
            notification.classList.remove('blink');
        }

        function reloadPage() {
            location.reload();
        }

        function checkConnection() {
            if (!navigator.onLine && isOnline) {
                isOnline = false;
                showNotification();
            } else if (navigator.onLine && !isOnline) {
                isOnline = true;
                document.getElementById('notification-text-ios-wifi').textContent = '¡Has recuperado la conexión WiFi!';
                document.getElementById('retry-button-ios-wifi').textContent = 'Cancelar';
            }
        }

        setInterval(checkConnection, 5000);
        window.addEventListener('offline', showNotification);
        window.addEventListener('online', reloadPage);
    </script>
    <!-- Fin info WiFi -->

    <script>
        document.getElementById('searchFacturacion').addEventListener('input', function () {
            const searchValue = this.value.toLowerCase();
            const rows = document.querySelectorAll('#data-table tbody tr');
    
            rows.forEach(row => {
                const textoFila = row.textContent.toLowerCase();
                const coincide = textoFila.includes(searchValue);
                row.style.display = coincide ? '' : 'none';
            });
        });
    </script>
    
    <!-- Avatar -->
    <script>
        function selectAvatar(imgFileName, altText, selectedElement) {
            const imgPath = `./Img/${imgFileName}`;
            const activeAvatar = document.getElementById("active-avatar");
            const onlineIndicator = document.querySelector(".online-indicator");

            // Cambiar el avatar activo
            activeAvatar.src = imgPath;
            activeAvatar.alt = altText;

            // Cambiar color del indicador a verde
            onlineIndicator.style.backgroundColor = "#32d554"; // Verde

            // Guardar en localStorage
            localStorage.setItem("selectedAvatarImg", imgFileName);
            localStorage.setItem("selectedAvatarAlt", altText);

            // Ocultar todos los avatares
            const avatars = document.querySelectorAll('.avatar');
            avatars.forEach(avatar => {
                avatar.style.display = 'block'; // Mostrar todos los avatares
            });

            // Ocultar el avatar seleccionado
            selectedElement.style.display = 'none'; // Ocultar el avatar seleccionado
        }

        window.addEventListener("DOMContentLoaded", () => {
            const savedImg = localStorage.getItem("selectedAvatarImg");
            const savedAlt = localStorage.getItem("selectedAvatarAlt");
            const activeAvatar = document.getElementById("active-avatar");
            const onlineIndicator = document.querySelector(".online-indicator");

            if (savedImg && savedAlt) {
                activeAvatar.src = `./Img/${savedImg}`;
                activeAvatar.alt = savedAlt;

                // Cambiar color del indicador a verde
                onlineIndicator.style.backgroundColor = "#32d554"; // Verde

                // Ocultar el avatar guardado
                const avatars = document.querySelectorAll('.avatar');
                avatars.forEach(avatar => {
                    avatar.style.display = 'block'; // Mostrar todos los avatares
                });

                // Ocultar el avatar guardado
                const selectedAvatar = [...avatars].find(avatar => avatar.querySelector('img').src.includes(savedImg));
                if (selectedAvatar) {
                    selectedAvatar.style.display = 'none'; // Ocultar el avatar guardado
                }
            } else {
                // Por defecto, avatar negro y color del indicador en rojo
                activeAvatar.src = "./Img/avatar-black.png";
                activeAvatar.alt = "Avatar-selected";
                onlineIndicator.style.backgroundColor = "red"; // Rojo
            }
        });
    </script>
    <!-- Avatar -->

    <!-- Footer -->
    <footer class="center">
        <img class="logo-foot" src="./Img/Novogar N.png" alt="Logo Novogar">
        <a class="www" href="https://novogar.com.ar/" target="_blank">NOVOGAR</a>
        <a href="https://novogar.com.ar/info/empresa" target="_blank">Quienes somos</a>
        <a href="https://novogar.com.ar/info/Sucursales" target="_blank">Sucursales</a>
        <a href="https://novogar.com.ar/info/ventaTelefonica" target="_blank">Atención al cliente</a>
        <button id="logoutButton" class="btn btn-danger mt-3"><i class="bi bi-person-gear mr-1"></i>Cerrar Sesión</button>
    </footer>   

    <!-- Scripts Firebase-->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Scripts Bootstrap-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <!-- Bootstrap JS (versión compatible con Bootstrap 5.1.3) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- XLSX -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
        
    <!-- Cargar dompurify -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.4/purify.min.js"></script>
    
    <!-- Cargar html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Cargar jsPDF -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="./js/firebase-init-Meli.js"></script>
    <script src="./js/firebase-init-cliente.js"></script>
    <script src="./js/features.js"></script>
    <script src="./js/posventa.js"></script>
    
</body>
</html>