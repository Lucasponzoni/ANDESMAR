<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Email con MailUp</title>
</head>
<body>
    <h1>Enviar Email</h1>
    <button id="sendEmailButton">Enviar Email</button>

    <script>
        document.getElementById('sendEmailButton').addEventListener('click', async () => {
            try {
                // Obtener el token
                const tokenResponse = await fetch('https://services.mailup.com/Authorization/OAuth/Token', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + btoa('168ac4cb-e699-465d-8808-24e215307ebe:437fcac2-58f7-43c4-b6e7-cdd7ad2ad26a'),
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        'grant_type': 'password',
                        'username': 'm154745',
                        'password': '2799Mendoza'
                    })
                });

                if (!tokenResponse.ok) {
                    throw new Error('Error al obtener el token: ' + tokenResponse.statusText);
                }

                const tokenData = await tokenResponse.json();
                const accessToken = tokenData.access_token;

                // Mostrar el token en consola
                console.log('Token de acceso:', accessToken);

                // Crear el mensaje
                const createMessageResponse = await fetch(`https://services.mailup.com/API/v1.1/Rest/ConsoleService.svc/Console/List/C4BCD75F-1EC5-4AF1-9449-6E077892E424/Email`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "Subject": "Asunto del Email",
                        "Body": "Este es el contenido del email.",
                        "SenderName": "NOVOGAR TEST",
                        "SenderAddress": "info@novogar.com.ar",
                        "ListId": "4C3720A1-FF8C-4D51-BDFE-75ACEADFC719" // Reemplaza con tu GUID
                    })
                });

                if (!createMessageResponse.ok) {
                    throw new Error('Error al crear el mensaje: ' + createMessageResponse.statusText);
                }

                const messageData = await createMessageResponse.json();
                const messageId = messageData.idMessage; // Asegúrate de usar el campo correcto

                // Enviar el email
                const emailResponse = await fetch(`https://services.mailup.com/API/v1.1/Rest/ConsoleService.svc/Console/List/C4BCD75F-1EC5-4AF1-9449-6E077892E424/Email/${messageId}/Send`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'application/json'
                    }
                });

                if (emailResponse.ok) {
                    alert('Email enviado exitosamente');
                } else {
                    const errorData = await emailResponse.json();
                    alert('Error al enviar el email: ' + errorData.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Ocurrió un error al enviar el email: ' + error.message);
            }
        });
    </script>
</body>
</html>
