<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Pedidos</title>
    <script>
        let sesion = '';

        async function autenticar() {
            const usuario = document.getElementById("usuario").value;
            const contrasenia = document.getElementById("contrasenia").value;

            const authData = {
                usuario: "Mmartinez",
                contrasenia: "NovogarRuta21"
            };

            try {
  const response = await fetch("https://proxy.cors.sh/http://190.210.249.71:8001/brainsys_test_api/seguridad/servicios/Autenticacion.asmx/Autenticar", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      'x-cors-api-key': 'live_36d58f4c13cb7d838833506e8f6450623bf2605859ac089fa008cfeddd29d8dd'
    },
    body: JSON.stringify(authData)
  });

  const result = await response.json();

  if (result.d.tipo === 0) {
    sesion = result.d.sesion;
    console.log("‚úÖ Autenticaci√≥n exitosa");
    console.log("üßæ Sesi√≥n:", sesion);
  } else {
    console.warn("‚ö†Ô∏è Error en autenticaci√≥n:", result.d.mensaje);
  }
} catch (error) {
  console.error("‚ùå Error al autenticar:", error);
}

        }

        async function enviarPedido() {
            if (!sesion) {
                alert("Primero debes autenticarte.");
                return;
            }

            const depositoId = document.getElementById("deposito").value;
            const pedido = {
                almacen: {
                    codigo: document.getElementById("almacenCodigo").value,
                    emplazamiento: {
                        codigo: document.getElementById("emplazamientoCodigo").value
                    }
                },
                tipo: {
                    codigo: document.getElementById("tipoCodigo").value
                },
                letra: document.getElementById("letra").value,
                centroEmisor: document.getElementById("centroEmisor").value,
                numero: parseInt(document.getElementById("numero").value),
                fechaEmision: document.getElementById("fechaEmision").value,
                fechaEntrega: document.getElementById("fechaEntrega").value,
                destinatario: {
                    cliente: {
                        codigo: document.getElementById("clienteCodigo").value
                    },
                    codigo: document.getElementById("destinatarioCodigo").value
                },
                razonSocial: document.getElementById("razonSocial").value,
                pais: document.getElementById("pais").value,
                provincia: document.getElementById("provincia").value,
                localidad: {
                    codigo: document.getElementById("localidadCodigo").value
                },
                domicilio: document.getElementById("domicilio").value,
                centroCosto: {
                    codigo: document.getElementById("centroCostoCodigo").value
                },
                darsena: {
                    codigo: document.getElementById("darsenaCodigo").value
                },
                numeroRuteo: parseInt(document.getElementById("numeroRuteo").value),
                entregaParcial: document.getElementById("entregaParcial").checked,
                importeFactura: parseFloat(document.getElementById("importeFactura").value),
                contraReembolso: parseFloat(document.getElementById("contraReembolso").value),
                prioridad: parseInt(document.getElementById("prioridad").value),
                referencia: document.getElementById("referencia").value,
                referenciaAdicional: document.getElementById("referenciaAdicional").value,
                observaciones: document.getElementById("observaciones").value,
                detalles: [
                    {
                        linea: 1,
                        producto: {
                            codigo: document.getElementById("productoCodigo").value,
                            compania: {
                                codigo: document.getElementById("companiaCodigo").value
                            }
                        },
                        lote: {
                            codigo: document.getElementById("loteCodigo").value,
                            vencimiento: document.getElementById("vencimiento").value
                        },
                        loteUnico: document.getElementById("loteUnico").checked,
                        serie: document.getElementById("serie").value,
                        estado: {
                            codigo: document.getElementById("estadoCodigo").value
                        },
                        cantidad: parseInt(document.getElementById("cantidad").value),
                        entregaParcial: document.getElementById("entregaParcialDetalle").checked
                    }
                ]
            };

            const requestData = {
                sesion: sesion,
                deposito: { id: depositoId },
                pedidos: [pedido]
            };

            try {
                const response = await fetch("https://proxy.cors.sh/http://190.210.249.71:8001/brainsys_test_api/deposito/servicios/Pedidos.asmx/Crear", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        'x-cors-api-key': 'live_36d58f4c13cb7d838833506e8f6450623bf2605859ac089fa008cfeddd29d8dd'
                    },
                    body: JSON.stringify(requestData)
                });
                const result = await response.json();
                console.log(result);
                alert(JSON.stringify(result));
            } catch (error) {
                console.error('Error al enviar el pedido:', error);
                alert('Error al enviar el pedido');
            }
        }
    </script>
</head>
<body>
    <h1>Test API Pedidos</h1>
    
    <h2>Autenticaci√≥n</h2>
    <form onsubmit="event.preventDefault(); autenticar();">
        <label for="usuario">Usuario:</label>
        <input value="Mmartinez" type="text" id="usuario" required><br>

        <label for="contrasenia">Contrase√±a:</label>
        <input value="NovogarRuta21" type="password" id="contrasenia" required><br>

        <button type="submit">Autenticar</button>
    </form>

    <h2>Enviar Pedido</h2>
    <form onsubmit="event.preventDefault(); enviarPedido();">
        <label for="deposito">Dep√≥sito:</label>
        <input value="" type="text" id="deposito" required><br>

        <label for="almacenCodigo">C√≥digo Almac√©n:</label>
        <input value="DEP" type="text" id="almacenCodigo" required><br>

        <label for="emplazamientoCodigo">C√≥digo Emplazamiento:</label>
        <input value="PLA" type="text" id="emplazamientoCodigo" required><br>

        <label for="tipoCodigo">C√≥digo Tipo:</label>
        <input value="PNG" type="text" id="tipoCodigo" required><br>

        <label for="letra">Letra:</label>
        <input value="R" type="text" id="letra" required><br>

        <label for="centroEmisor">Centro Emisor:</label>
        <input value="0254" type="text" id="centroEmisor" required><br>

        <label for="numero">N√∫mero:</label>
        <input value="1111" type="number" id="numero" required><br>

        <label for="fechaEmision">Fecha Emisi√≥n:</label>
        <input type="datetime-local" id="fechaEmision" required><br>

        <label for="fechaEntrega">Fecha Entrega:</label>
        <input type="datetime-local" id="fechaEntrega" required><br>

        <label for="clienteCodigo">C√≥digo Cliente:</label>
        <input value="NOG" type="text" id="clienteCodigo" required><br>

        <label for="destinatarioCodigo">C√≥digo Destinatario:</label>
        <input value="ENO" type="text" id="destinatarioCodigo" required><br>

        <label for="razonSocial">Raz√≥n Social:</label>
        <input type="text" id="razonSocial" required><br>

        <label for="pais">Pa√≠s:</label>
        <input value="ARG" type="text" id="pais" required><br>

        <label for="provincia">Provincia:</label>
        <input value="buenos aires" type="text" id="provincia" required><br>

        <label for="localidadCodigo">C√≥digo Localidad:</label>
        <input type="text" id="localidadCodigo" required><br>

        <label for="domicilio">Domicilio:</label>
        <input type="text" id="domicilio" required><br>

        <label for="centroCostoCodigo">C√≥digo Centro Costo:</label>
        <input type="text" id="centroCostoCodigo" required><br>

        <label for="darsenaCodigo">C√≥digo D√°rsena:</label>
        <input type="text" id="darsenaCodigo" required><br>

        <label for="numeroRuteo">N√∫mero Ruteo:</label>
        <input type="number" id="numeroRuteo" required><br>

        <label for="entregaParcial">Entrega Parcial:</label>
        <input type="checkbox" id="entregaParcial"><br>

        <label for="importeFactura">Importe Factura:</label>
        <input type="number" id="importeFactura" required><br>

        <label for="contraReembolso">Contra Reembolso:</label>
        <input type="number" id="contraReembolso" required><br>

        <label for="prioridad">Prioridad:</label>
        <input type="number" id="prioridad" required><br>

        <label for="referencia">Referencia:</label>
        <input type="text" id="referencia" required><br>

        <label for="referenciaAdicional">Referencia Adicional:</label>
        <input type="text" id="referenciaAdicional"><br>

        <label for="observaciones">Observaciones:</label>
        <input type="text" id="observaciones"><br>

        <label for="productoCodigo">C√≥digo Producto:</label>
        <input type="text" id="productoCodigo" required><br>

        <label for="companiaCodigo">C√≥digo Compa√±√≠a:</label>
        <input type="text" id="companiaCodigo" required><br>

        <label for="loteCodigo">C√≥digo Lote:</label>
        <input type="text" id="loteCodigo" required><br>

        <label for="vencimiento">Vencimiento:</label>
        <input type="datetime-local" id="vencimiento" required><br>

        <label for="loteUnico">Lote √önico:</label>
        <input type="checkbox" id="loteUnico"><br>

        <label for="serie">Serie:</label>
        <input type="text" id="serie" required><br>

        <label for="estadoCodigo">C√≥digo Estado:</label>
        <input type="text" id="estadoCodigo" required><br>

        <label for="cantidad">Cantidad:</label>
        <input type="number" id="cantidad" required><br>

        <label for="entregaParcialDetalle">Entrega Parcial Detalle:</label>
        <input type="checkbox" id="entregaParcialDetalle"><br>

        <button type="submit">Enviar Pedido</button>
    </form>
</body>
</html>
