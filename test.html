<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Despachos del Día</title>
</head>
<body>

<h2>Procesar Despachos del Día</h2>
<button id="procesarBtn">Procesar Remitos</button>

<!-- Scripts de Firebase (deben ir antes de tu código personalizado) -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Tus inicializadores personalizados (van después de Firebase) -->
<script src="./js/firebase-init-stock.js"></script>
<script src="./js/firebase-init-tipeo.js"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<script>
  document.getElementById("procesarBtn").addEventListener("click", async () => {
    // Estas referencias deben estar definidas en firebase-init-stock.js y firebase-init-tipeo.js
    // Asegurate de tener algo como:
    //   const dbStock = firebase.database(); // en uno
    //   const dbTipeo = firebase.database(); // en otro

    try {
      const despachosSnap = await dbTipeo.ref("despachosDelDia").once("value");
      const despachos = despachosSnap.val();

      if (!despachos) {
        console.log("No hay remitos en 'despachosDelDia'");
        return;
      }

      const remitoKeys = Object.keys(despachos);

      for (const remito of remitoKeys) {
        const remitoSnap = await dbStock.ref(`RemitosWeb/${remito}`).once("value");

        if (remitoSnap.exists()) {
          const info = remitoSnap.val();
          await dbTipeo.ref(`despachosDelDia/${remito}/Info`).set(info);
          console.log(`✔ Copiado Remito ${remito} a despachosDelDia/${remito}/Info`);
        } else {
          console.log(`✖ Remito ${remito} no encontrado en RemitosWeb`);
        }
      }

      alert("Proceso finalizado.");

    } catch (error) {
      console.error("Error procesando remitos:", error);
    }
  });
</script>

</body>
</html>
